<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>EcoPez: MisiÃ³n Marinero</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #0f172a;
        font-family: 'Press Start 2P', cursive;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      #root {
        width: 100%;
        height: 100%;
      }

      canvas {
        image-rendering: pixelated;
        display: block;
      }
      
      .scanline {
        background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
        background-size: 100% 4px;
        position: absolute;
        top: 0; right: 0; bottom: 0; left: 0;
        pointer-events: none;
        z-index: 40;
      }

      .text-shadow-custom {
        text-shadow: 2px 2px 0px #000;
      }

      .btn-press:active {
        transform: scale(0.95);
        filter: brightness(0.9);
      }
    </style>
    
    <!-- IMPORT MAP FIX FOR REACT 18 -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react, typescript">
        import React, { useState, useEffect, useRef, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Trash2, Award, Play, RotateCcw, ChevronLeft, ChevronRight, ArrowUp } from 'lucide-react';

        // ==========================================
        // CONSTANTS & ASSETS
        // ==========================================
        
        const GAME_ASSETS = {
            LOGO: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/logo1.png",
            PLAYER: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/MateoPlayer.gif",
            
            // BASURA
            TRASH_BOTTLE: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/botella.png",
            TRASH_BAG: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/bolsa.png",
            TRASH_TIRE: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/llanta.png",
            TRASH_BOOT: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/bota.png",

            // ENEMIGOS
            ENEMY_JELLYFISH: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/medusa.png",
            ENEMY_SHARK: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/tiburon.png",
            
            // FONDO
            BG_LAYER: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/fondo1.png",

            // DECORACIÃ“N
            DECO_ALGA_1: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/alga1.png",
            DECO_ALGA_2: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/alga2.png",
            DECO_ALGA_3: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/alga3.png",
            DECO_CORAL_1: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/coral1.png",
            DECO_CORAL_2: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/coral2.png",
            DECO_CORAL_3: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/coral3.png",
            DECO_CORAL_4: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/coral4.png",
            DECO_CORAL_5: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/coral5.png",
            DECO_ROCK_1: "https://raw.githubusercontent.com/nsanchezBG/MarineroSTSBG/main/roca1.png"
        };

        const CUSTOM_MESSAGES = [
            { title: "Marinero de Agua Dulce", message: "Â¡Buen inicio! Pero el mar necesita mÃ¡s limpieza." },
            { title: "Grumete Reciclador", message: "Â¡Bien hecho! Esa basura ya no daÃ±arÃ¡ a las tortugas." },
            { title: "CapitÃ¡n del Arrecife", message: "Â¡IncreÃ­ble! Tu red estÃ¡ llena de buenas acciones." },
            { title: "Almirante EcolÃ³gico", message: "Â¡El ocÃ©ano te saluda! Una puntuaciÃ³n legendaria." },
            { title: "PoseidÃ³n de la Limpieza", message: "Â¡Nadie cuida el mar mejor que tÃº!" }
        ];

        const LOGICAL_WIDTH = 400; 
        const LOGICAL_HEIGHT = 800;
        
        const GRAVITY = 0.25;
        const SWIM_FORCE = -7; 
        const MAX_SPEED = 5;
        const FRICTION = 0.96;
        
        const COLORS = {
            BRAND_RED: '#dc2626',
            BRAND_YELLOW: '#facc15',
            BRAND_BLUE_LIGHT: '#38bdf8',
            BRAND_BLUE_DARK: '#0369a1',
            SAND: '#fcd34d'
        };

        const KEYS = {
            UP: ['ArrowUp', 'w', 'W', ' '],
            LEFT: ['ArrowLeft', 'a', 'A'],
            RIGHT: ['ArrowRight', 'd', 'D']
        };

        // ==========================================
        // GAME LOGIC COMPONENT
        // ==========================================

        const GameCanvas = ({ status, onScoreUpdate, onGameOver }) => {
            const canvasRef = useRef(null);
            const domPlayerRef = useRef(null);
            const requestRef = useRef(0);
            const frameCountRef = useRef(0);
            const facingRef = useRef('RIGHT');
            const [images, setImages] = useState({});
            const nextDecoSpawnRef = useRef(0);
            
            // KEYBOARD INPUT STATE (Persistent ref)
            const keysRef = useRef(new Set());

            // Load Assets
            useEffect(() => {
                const loaded = {};
                const keys = Object.keys(GAME_ASSETS).filter(k => k !== 'PLAYER');
                let count = 0;
                if (keys.length === 0) setImages({});
                
                keys.forEach(key => {
                    const img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.src = GAME_ASSETS[key];
                    img.onload = () => { loaded[key] = img; count++; if(count===keys.length) setImages(loaded); };
                    img.onerror = () => { console.warn('Error loading asset:', key); count++; if(count===keys.length) setImages(loaded); };
                });
            }, []);

            // Game State
            const gameState = useRef({
                player: { x: 50, y: LOGICAL_HEIGHT/2, vx: 0, vy: 0, width: 80, height: 80, invincible: 0 },
                entities: [],
                decorations: [],
                particles: [],
                score: 0
            });

            // Input Listeners
            useEffect(() => {
                const down = (e) => keysRef.current.add(e.key);
                const up = (e) => keysRef.current.delete(e.key);
                const touchDown = (e) => keysRef.current.add(e.detail.key);
                const touchUp = (e) => keysRef.current.delete(e.detail.key);

                window.addEventListener('keydown', down);
                window.addEventListener('keyup', up);
                window.addEventListener('game-input-down', touchDown);
                window.addEventListener('game-input-up', touchUp);

                return () => {
                    window.removeEventListener('keydown', down);
                    window.removeEventListener('keyup', up);
                    window.removeEventListener('game-input-down', touchDown);
                    window.removeEventListener('game-input-up', touchUp);
                };
            }, []);

            // Reset Game
            useEffect(() => {
                if (status === 'PLAYING') {
                    gameState.current = {
                        player: { x: 50, y: LOGICAL_HEIGHT/2, vx: 0, vy: 0, width: 80, height: 80, invincible: 0 },
                        entities: [],
                        decorations: [],
                        particles: [],
                        score: 0
                    };
                    frameCountRef.current = 0;
                    nextDecoSpawnRef.current = 30;
                    onScoreUpdate(0);
                }
            }, [status]);

            // Game Loop
            const loop = useCallback(() => {
                if (status !== 'PLAYING') return;
                
                const state = gameState.current;
                const { player } = state;
                const keys = keysRef.current;
                frameCountRef.current++;
                const fc = frameCountRef.current;

                // --- SPAWNERS ---
                if (fc % 100 === 0) { // Trash
                    const types = ['TRASH_BOTTLE', 'TRASH_TIRE', 'TRASH_BAG', 'TRASH_BOOT'];
                    const type = types[Math.floor(Math.random()*types.length)];
                    state.entities.push({
                        type, id: Math.random(), 
                        x: LOGICAL_WIDTH + 50, 
                        y: Math.random() * (LOGICAL_HEIGHT - 200) + 50, // Fixed height to reach ground
                        w: 60, h: 60, 
                        vx: -2 - Math.random(), vy: 0, 
                        asset: type
                    });
                }
                if (fc % 180 === 0) { // Enemies
                    const types = ['ENEMY_JELLYFISH', 'ENEMY_SHARK'];
                    const type = types[Math.floor(Math.random()*types.length)];
                    const isShark = type === 'ENEMY_SHARK';
                    state.entities.push({
                        type, id: Math.random(), 
                        x: LOGICAL_WIDTH + 50, 
                        y: Math.random() * (LOGICAL_HEIGHT - 200) + 50, // Limit spawn height
                        w: isShark ? 150 : 60, h: isShark ? 60 : 60,
                        vx: isShark ? -4 - Math.random() : -2, 
                        vy: isShark ? 0 : Math.sin(fc/50)*0.5,
                        asset: type
                    });
                }
                
                // Random Decor Spawn
                if (fc >= nextDecoSpawnRef.current) { 
                    const algae = ['DECO_ALGA_1', 'DECO_ALGA_2', 'DECO_ALGA_3'];
                    const corals = ['DECO_CORAL_1', 'DECO_CORAL_2', 'DECO_CORAL_3', 'DECO_CORAL_4', 'DECO_CORAL_5'];
                    const rocks = ['DECO_ROCK_1'];
                    
                    const allDecos = [...algae, ...corals, ...rocks];
                    const assetKey = allDecos[Math.floor(Math.random()*allDecos.length)];
                    
                    let w = 50, h = 50;
                    if (algae.includes(assetKey)) { w = 40; h = 70; }
                    else if (rocks.includes(assetKey)) { w = 70; h = 45; }
                    else if (corals.includes(assetKey)) { w = 60; h = 60; }

                    state.decorations.push({
                         id: Math.random(), 
                         x: LOGICAL_WIDTH + 50, 
                         y: LOGICAL_HEIGHT - h - 20 + (Math.random()*10),
                         w: w, h: h, 
                         vx: -1.5, 
                         asset: assetKey
                    });

                    nextDecoSpawnRef.current = fc + Math.floor(Math.random() * 80) + 40;
                }

                // --- PHYSICS ---
                let swim = false;
                KEYS.UP.forEach(k => { if(keys.has(k)) swim = true; });
                
                let dx = 0;
                KEYS.LEFT.forEach(k => { if(keys.has(k)) dx = -1; });
                KEYS.RIGHT.forEach(k => { if(keys.has(k)) dx = 1; });

                if (swim) {
                    player.vy += SWIM_FORCE * 0.15;
                    if (fc % 5 === 0) state.particles.push({
                        x: player.x + (facingRef.current === 'RIGHT' ? 0 : player.width), 
                        y: player.y + 40, 
                        vx: (Math.random()-0.5)*2, vy: 1, 
                        life: 20, color: 'rgba(255,255,255,0.5)', w:6, h:6
                    });
                }

                if (dx !== 0) {
                    player.vx += dx * 0.5;
                    facingRef.current = dx > 0 ? 'RIGHT' : 'LEFT';
                }

                player.vy += GRAVITY;
                player.vx *= FRICTION;
                player.vy *= FRICTION;

                player.x += player.vx;
                player.y += player.vy;
                
                if (player.y < 0) { player.y = 0; player.vy = 0; }
                if (player.y > LOGICAL_HEIGHT - player.height - 30) { player.y = LOGICAL_HEIGHT - player.height - 30; player.vy = 0; }
                if (player.x < 0) { player.x = 0; player.vx = 0; }
                if (player.x > LOGICAL_WIDTH - player.width) { player.x = LOGICAL_WIDTH - player.width; player.vx = 0; }

                if (player.invincible > 0) player.invincible--;

                // --- ENTITIES ---
                state.entities.forEach(e => {
                    e.x += e.vx;
                    e.y += e.vy;

                    // Particles for enemies
                    if (e.type === 'ENEMY_SHARK' && fc % 4 === 0) {
                        state.particles.push({
                            x: e.x + e.w - 10, y: e.y + e.h / 2,
                            vx: 2, vy: (Math.random() - 0.5) * 2,
                            life: 25, color: 'rgba(255,255,255,0.4)', w: 5, h: 5
                        });
                    } else if (e.type === 'ENEMY_JELLYFISH' && fc % 15 === 0) {
                         state.particles.push({
                            x: e.x + e.w / 2, y: e.y + e.h - 10,
                            vx: 0, vy: 1, life: 40, color: 'rgba(255,255,255,0.3)', w: 3, h: 3
                        });
                    }
                    
                    // Collision
                    if (
                        player.x < e.x + e.w - 15 &&
                        player.x + player.width > e.x + 15 &&
                        player.y < e.y + e.h - 15 &&
                        player.y + player.height > e.y + 15
                    ) {
                        if (e.type.startsWith('TRASH')) {
                            e.delete = true;
                            state.score += 10;
                            onScoreUpdate(state.score);
                            
                            let pColor = '#fff';
                            if (e.type.includes('TIRE')) pColor = '#1f2937'; 
                            else if (e.type.includes('BOOT')) pColor = '#78350f';
                            else if (e.type.includes('BAG')) pColor = '#9ca3af';
                            else if (e.type.includes('BOTTLE')) pColor = '#3b82f6';

                            for(let i=0; i<8; i++) state.particles.push({
                                x: e.x + e.w/2, y: e.y + e.h/2, 
                                vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12, 
                                life: 30, color: pColor, w: 8, h:8
                            });
                        } else if (e.type.startsWith('ENEMY') && player.invincible === 0) {
                            onGameOver(state.score);
                        }
                    }
                    if (e.x < -150) e.delete = true;
                });

                state.decorations.forEach(d => {
                    d.x += d.vx;
                    if (d.x < -100) d.delete = true;
                });

                state.particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy; p.life--;
                });

                state.entities = state.entities.filter(e => !e.delete);
                state.decorations = state.decorations.filter(d => !d.delete);
                state.particles = state.particles.filter(p => p.life > 0);

            }, [status, onScoreUpdate, onGameOver]);

            // Draw Loop
            const draw = useCallback(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const state = gameState.current;

                ctx.clearRect(0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);
                
                // Gradient base
                const grad = ctx.createLinearGradient(0, 0, 0, LOGICAL_HEIGHT);
                grad.addColorStop(0, COLORS.BRAND_BLUE_LIGHT);
                grad.addColorStop(1, COLORS.BRAND_BLUE_DARK);
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);

                // Background Parallax
                if (images['BG_LAYER']) {
                    const bgX = -(frameCountRef.current * 0.5) % LOGICAL_WIDTH;
                    ctx.drawImage(images['BG_LAYER'], bgX, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);
                    ctx.drawImage(images['BG_LAYER'], bgX + LOGICAL_WIDTH, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);
                }

                // Floor
                ctx.fillStyle = COLORS.SAND;
                ctx.fillRect(0, LOGICAL_HEIGHT - 40, LOGICAL_WIDTH, 40);

                // Deco
                state.decorations.forEach(d => {
                    if (images[d.asset]) ctx.drawImage(images[d.asset], d.x, d.y, d.w, d.h);
                });

                // Entities
                state.entities.forEach(e => {
                    if (images[e.asset]) {
                        ctx.drawImage(images[e.asset], e.x, e.y, e.w, e.h);
                    } else {
                        ctx.fillStyle = 'red'; ctx.fillRect(e.x, e.y, e.w, e.h);
                    }
                });

                // Particles
                state.particles.forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.w, p.h);
                });

                // Sync Player DOM
                const p = state.player;
                if (domPlayerRef.current) {
                    const domEl = domPlayerRef.current;
                    if (status === 'PLAYING') {
                        domEl.style.display = 'block';
                        
                        // Percentage positioning to match "object-fit: fill" stretch
                        const leftPct = (p.x / LOGICAL_WIDTH) * 100;
                        const topPct = (p.y / LOGICAL_HEIGHT) * 100;
                        const wPct = (p.width / LOGICAL_WIDTH) * 100;
                        const hPct = (p.height / LOGICAL_HEIGHT) * 100;

                        domEl.style.left = `${leftPct}%`;
                        domEl.style.top = `${topPct}%`;
                        domEl.style.width = `${wPct}%`;
                        domEl.style.height = `${hPct}%`;
                        
                        const scaleX = facingRef.current === 'LEFT' ? -1 : 1;
                        domEl.style.transform = `scaleX(${scaleX})`;
                        
                        domEl.style.opacity = (p.invincible > 0 && Math.floor(Date.now()/100)%2 !== 0) ? '0.5' : '1';
                    } else {
                        domEl.style.display = 'none';
                    }
                }

            }, [images, status]);

            useEffect(() => {
                const animate = () => {
                    loop();
                    draw();
                    requestRef.current = requestAnimationFrame(animate);
                };
                requestRef.current = requestAnimationFrame(animate);
                return () => cancelAnimationFrame(requestRef.current);
            }, [loop, draw]);

            return (
                <div className="relative w-full h-full">
                    {/* CANVAS CON OBJECT-FIT: FILL PARA OCUPAR TODA LA PANTALLA */}
                    <canvas 
                        ref={canvasRef} 
                        width={LOGICAL_WIDTH} 
                        height={LOGICAL_HEIGHT}
                        style={{ width: '100%', height: '100%', objectFit: 'fill' }}
                    />
                    {/* PLAYER OVERLAY (GIF) */}
                    <img 
                        ref={domPlayerRef}
                        src={GAME_ASSETS.PLAYER}
                        className="absolute pointer-events-none hidden"
                        style={{
                            imageRendering: 'pixelated', 
                            willChange: 'left, top, transform'
                        }}
                    />
                </div>
            );
        };

        // ==========================================
        // UI COMPONENTS & APP
        // ==========================================

        const App = () => {
            const [status, setStatus] = useState('START');
            const [score, setScore] = useState(0);
            const [highScore, setHighScore] = useState(0);
            const [gameOverData, setGameOverData] = useState(null);

            const emitInput = (key, type) => {
                const event = new CustomEvent(type === 'down' ? 'game-input-down' : 'game-input-up', { detail: { key } });
                window.dispatchEvent(event);
            };

            const handleGameOver = useCallback((finalScore) => {
                setStatus('GAME_OVER');
                setHighScore(h => Math.max(h, finalScore));
                const msg = CUSTOM_MESSAGES[Math.floor(Math.random() * CUSTOM_MESSAGES.length)];
                setGameOverData(msg);
            }, []);

            return (
                <div className="w-full h-full bg-slate-900 flex justify-center items-center overflow-hidden">
                    
                    {/* CONTENEDOR FULL SCREEN (Sin max-width) */}
                    <div className="relative w-full h-full bg-black overflow-hidden">
                        
                        {/* GAME LAYER */}
                        <div className="absolute inset-0 z-0 bg-[#0369a1]">
                            <GameCanvas 
                                status={status}
                                onScoreUpdate={setScore}
                                onGameOver={handleGameOver}
                            />
                        </div>

                        {/* SCANLINE OVERLAY */}
                        <div className="scanline z-10"></div>

                        {/* TOP HUD REFINADO Y FLOTANTE */}
                        <div className="absolute top-4 left-0 right-0 z-20 px-4 pointer-events-none">
                            <div className="relative bg-[#b91c1c] border-b-4 border-[#facc15] rounded-full shadow-lg h-12 flex items-center justify-between px-4 text-white w-full pointer-events-auto">
                                
                                {/* SCORE LEFT */}
                                <div className="flex items-center gap-2 bg-black/20 px-3 py-1 rounded-full border border-white/10">
                                    <Trash2 className="w-3 h-3 md:w-4 md:h-4 text-[#facc15]" />
                                    <span className="text-[10px] md:text-xs font-mono font-bold tracking-widest">{score.toString().padStart(5,'0')}</span>
                                </div>

                                {/* LOGO ABSOLUTE CENTER (SOBRESALE) */}
                                <img 
                                    src={GAME_ASSETS.LOGO} 
                                    alt="Marinero Logo" 
                                    className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-20 md:h-24 object-contain drop-shadow-md z-10"
                                />

                                {/* HIGHSCORE RIGHT */}
                                <div className="flex items-center gap-2 bg-black/20 px-3 py-1 rounded-full border border-white/10">
                                    <Award className="w-3 h-3 md:w-4 md:h-4 text-[#facc15]" />
                                    <span className="text-[10px] md:text-xs font-mono font-bold tracking-widest">{highScore.toString().padStart(5,'0')}</span>
                                </div>
                            </div>
                        </div>

                        {/* CONTROLS */}
                        {status === 'PLAYING' && (
                            <div className="absolute bottom-0 left-0 right-0 z-30 p-4 pb-8 flex justify-between items-end pointer-events-none select-none">
                                <div className="flex gap-4 pointer-events-auto">
                                    <button 
                                        className="w-20 h-20 bg-[#facc15] border-b-8 border-[#ca8a04] rounded-full shadow-lg flex items-center justify-center btn-press active:bg-yellow-300 active:border-b-0 active:translate-y-2 transition-all touch-manipulation"
                                        onTouchStart={(e) => { e.preventDefault(); emitInput('ArrowLeft', 'down'); }}
                                        onTouchEnd={(e) => { e.preventDefault(); emitInput('ArrowLeft', 'up'); }}
                                        onMouseDown={() => emitInput('ArrowLeft', 'down')}
                                        onMouseUp={() => emitInput('ArrowLeft', 'up')}
                                        onMouseLeave={() => emitInput('ArrowLeft', 'up')}
                                    >
                                        <ChevronLeft className="w-10 h-10 text-[#b91c1c]" strokeWidth={4} />
                                    </button>
                                    <button 
                                        className="w-20 h-20 bg-[#facc15] border-b-8 border-[#ca8a04] rounded-full shadow-lg flex items-center justify-center btn-press active:bg-yellow-300 active:border-b-0 active:translate-y-2 transition-all touch-manipulation"
                                        onTouchStart={(e) => { e.preventDefault(); emitInput('ArrowRight', 'down'); }}
                                        onTouchEnd={(e) => { e.preventDefault(); emitInput('ArrowRight', 'up'); }}
                                        onMouseDown={() => emitInput('ArrowRight', 'down')}
                                        onMouseUp={() => emitInput('ArrowRight', 'up')}
                                        onMouseLeave={() => emitInput('ArrowRight', 'up')}
                                    >
                                        <ChevronRight className="w-10 h-10 text-[#b91c1c]" strokeWidth={4} />
                                    </button>
                                </div>

                                <div className="pointer-events-auto">
                                    <button 
                                        className="w-24 h-24 bg-[#b91c1c] border-b-8 border-[#7f1d1d] rounded-full shadow-lg flex flex-col items-center justify-center btn-press active:bg-red-500 active:border-b-0 active:translate-y-2 transition-all touch-manipulation"
                                        onTouchStart={(e) => { e.preventDefault(); emitInput(' ', 'down'); }}
                                        onTouchEnd={(e) => { e.preventDefault(); emitInput(' ', 'up'); }}
                                        onMouseDown={() => emitInput(' ', 'down')}
                                        onMouseUp={() => emitInput(' ', 'up')}
                                        onMouseLeave={() => emitInput(' ', 'up')}
                                    >
                                        <ArrowUp className="w-10 h-10 text-white mb-1" strokeWidth={4} />
                                        <span className="text-[10px] font-bold text-[#facc15]">NADAR</span>
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* SCREENS */}
                        {status !== 'PLAYING' && (
                            <div className="absolute inset-0 z-40 flex items-center justify-center bg-black/60 backdrop-blur-sm p-6">
                                {/* START SCREEN */}
                                {status === 'START' && (
                                    <div className="bg-[#b91c1c] p-1 rounded-2xl shadow-2xl border-4 border-[#facc15] w-full max-w-sm animate-in zoom-in duration-300">
                                        <div className="bg-[#0f172a] rounded-xl p-6 text-center flex flex-col items-center">
                                            {/* LOGO EN PANTALLA DE INICIO */}
                                            <img 
                                                src={GAME_ASSETS.LOGO} 
                                                alt="Marinero" 
                                                className="w-48 object-contain mb-6 animate-pulse"
                                            />
                                            
                                            <div className="w-full bg-blue-900/50 p-4 rounded-lg mb-6 border border-blue-500/30 text-xs text-blue-100 leading-relaxed font-sans">
                                                <p className="mb-2">ðŸŒŠ Â¡El mar estÃ¡ lleno de basura!</p>
                                                <p>Ayuda al pez Marinero a recolectar botellas y evitar medusas y tiburones.</p>
                                            </div>

                                            <button 
                                                onClick={() => { setStatus('PLAYING'); setScore(0); }}
                                                className="w-full py-4 bg-[#facc15] hover:bg-yellow-300 text-[#b91c1c] font-bold text-lg rounded-lg shadow-[0_4px_0_#a16207] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2"
                                            >
                                                <Play className="fill-current w-5 h-5" />
                                                Â¡AL AGUA!
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* GAME OVER SCREEN */}
                                {status === 'GAME_OVER' && (
                                    <div className="bg-white p-1 rounded-2xl shadow-2xl border-4 border-[#0369a1] w-full max-w-sm animate-in slide-in-from-bottom duration-500">
                                        <div className="bg-[#f0f9ff] rounded-xl p-6 text-center flex flex-col items-center">
                                            {/* LOGO EN GAME OVER (Reemplaza calavera) */}
                                            <img 
                                                src={GAME_ASSETS.LOGO} 
                                                alt="Marinero" 
                                                className="h-16 object-contain mb-4 animate-bounce"
                                            />
                                            
                                            <h2 className="text-2xl text-[#0369a1] font-bold mb-4">Â¡OH NO!</h2>
                                            
                                            <div className="w-full bg-white p-4 rounded-lg border-2 border-[#b91c1c] mb-6 shadow-sm transform -rotate-1">
                                                <div className="text-xs text-slate-500 font-bold uppercase mb-1">PuntuaciÃ³n Final</div>
                                                <div className="text-4xl font-black text-[#b91c1c]">{score}</div>
                                            </div>

                                            {gameOverData && (
                                                <div className="mb-6">
                                                    <div className="text-[#0369a1] font-bold text-sm uppercase border-b border-blue-200 pb-1 mb-2">
                                                        {gameOverData.title}
                                                    </div>
                                                    <p className="text-xs text-slate-600 italic leading-relaxed">
                                                        "{gameOverData.message}"
                                                    </p>
                                                </div>
                                            )}

                                            <button 
                                                onClick={() => { setStatus('PLAYING'); setScore(0); }}
                                                className="w-full py-4 bg-[#b91c1c] hover:bg-red-600 text-white font-bold text-lg rounded-lg shadow-[0_4px_0_#7f1d1d] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2"
                                            >
                                                <RotateCcw className="w-5 h-5" />
                                                REINTENTAR
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
